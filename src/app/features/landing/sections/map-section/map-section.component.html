<section class="map-section section" id="presence" aria-labelledby="presence-heading">
  <div class="container">

    <div class="map-section__header">
      <h2 class="map-section__title" id="presence-heading">OUR PRESENCE</h2>
    </div>

    <div class="map-section__tabs-wrapper">
      <div class="map-section__tabs" role="tablist" aria-label="Regional presence tabs">
        @for (tab of tabs; track tab.id) {
          <button
            class="map-section__tab"
            [class.map-section__tab--active]="activeTabId() === tab.id"
            (click)="selectTab(tab.id)"
            type="button"
            role="tab"
            [attr.aria-selected]="activeTabId() === tab.id"
            [id]="'tab-' + tab.id"
          >
            {{ tab.label }}
          </button>
        }
      </div>
    </div>

  </div>

  <div class="map-section__map-wrapper" role="region" aria-label="Map showing operation locations">
    <img
      src="assets/map image.png"
      alt="World map showing AXEOR presence"
      class="map-section__map-image"
      loading="lazy"
    />

    @for (marker of activeTab.markers; track marker.id) {
      <button
        class="map-section__marker"
        [class.map-section__marker--active]="activeMarkerId() === marker.id"
        [style.top]="marker.top"
        [style.left]="marker.left"
        (click)="toggleMarker(marker.id)"
        type="button"
        [attr.aria-label]="marker.city"
        [attr.aria-expanded]="activeMarkerId() === marker.id"
      >
        <svg
          class="map-section__marker-icon"
          viewBox="72 126 60 60"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
          focusable="false"
        >
          <g class="map-section__marker-pulse">
            <rect x="78" y="132" width="48" height="48" rx="24" fill="#A20E20" opacity="0.35"/>
          </g>
          <rect x="88" y="142" width="28" height="28" rx="14" fill="#A20E20" filter="url(#markerShadow)"/>
          <rect x="98" y="152" width="8" height="8" rx="4" fill="white"/>
          <defs>
            <filter id="markerShadow" x="-30%" y="-30%" width="160%" height="160%">
              <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#A20E20" flood-opacity="0.45"/>
            </filter>
          </defs>
        </svg>

        @if (activeMarkerId() === marker.id) {
          <div class="map-section__tooltip" role="tooltip">
            <strong class="map-section__tooltip-city">{{ marker.city }}</strong>
            <p class="map-section__tooltip-address">{{ marker.address }}</p>
          </div>
        }
      </button>
    }
  </div>
</section>
